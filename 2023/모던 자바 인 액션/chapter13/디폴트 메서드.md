
# 디폴트 메서드.

---------------------------------------------------------------------------------------------------------------------------------

> ## 변화하는 API.

### 정적 메서드와 인터페이스.
- 자바 8에서부터 인터페이스에 직접 정적 메서드를 선언할 수 있다.
- 그러나, 8이전에 만들어진 유틸리티 클래스들은 호환성 때문에 남아 있다.


### 인터페이스를 고쳤을 때 사용자가 겪는 문제점.
- 인터페이스를 구현하는 모든 클래스는 변경된/추가된 메서드를 작성해야 한다.
   - 버전을 직접 관리하는 해결 방법이 있다.
     - 문제1 : 라이브러리를 직접 관리하기 복잡하다.
     - 문제2 : 같은 코드에 예전 버전과, 새로운 버전 두 가지 라이브러리를 모두 사용해야 할 수도 있다.

    
### 바이너리 호환성.
- 뭔가를 수정한 이후에도 에러 없이 기존 바이너리가 실행될 수 있는 상황을 의미한다.
- 새로 추가된 메서드를 호출하지만 않으면 새로운 메서드 구현이 없이도 기존 클래스 파일 구현이 잘 동작한다는 의미.


### 소스 호환성.
- 코드를 고쳐도 기존 프로그램을 성공적으로 재컴파일할 수 있음을 의미한다.


### 동작 호환성.
- 코드를 바꾼 다음에도 같은 입력값이 주어지면 프로그램이 같은 동작을 실행한다는 의미다.

---------------------------------------------------------------------------------------------------------------------------------

> ## 디폴트 메서드란 무엇인가?

### 디폴트 메서드 default method.
- 자바8에서 추가된 기능으로, 인터페이스에 기본 구현을 제공할 수 있는 메소드를 의미한다.
- 이전에는 추상 클래스를 사용해야 했던 내용을 인터페이스에서 구현할 수 있어서 개발의 편의성이 증가하였다.
- 디폴트 메서드 추가는 소스 호환성이 유지된다.


### 예시 코드.
    public interface Sized {
        int size();
        default boolean isEmpty() {
            return size() == 0;
        }
    }


### 디폴트 메서드가 사용된 예시.
- Collection 인터페이스의 stream() 메서드.
- List 인터페이스의 sort() 메서드.
- Predicate 인터페이스 and() 메서드.
- Function 인터페이스 andThen() 메서드.
- ...


### 추상 클래스와 자바 8의 인터페이스.
1. 클래스는 하나의 추상 클래스만 상속받을 수 있지만, 인터페이스는 여러 개 구현할 수 있다.
2. 추상 클래스는 인스턴스 변수로 공통 상태를 가질 수 있지만, 인터페이스는 인스턴스 변수를 가질 수 없다.

---------------------------------------------------------------------------------------------------------------------------------

> ## 디폴트 메서드 활용 패턴.

### 디폴트 메서드를 이용하는 2가지 방식.
1. 선택형 메서드 optional method.
2. 동작 다중 상속 multiple inheritance of behavior.


### 선택형 메서드.
- 하나의 인터페이스에서 abstract 메서드와 default 메서드를 선택적으로 사용하는 것을 의미한다. 


### 동작 다중 상속.
- 인터페이스를 여러 개 구현하는 것 또는 하나의 클래스와 하나 이상의 인터페이스를 구현하는 것을 의미한다.


### 옳지 못한 상속.
- 상속으로 코드 재사용 문제를 모두 해결할 수 있는 것은 아니다.
- 예를 들어, 한 개의 메서드를 재사용하려고 100개의 메서드와 필드가 정의되어 있는 클래스를 상속받는 것은 좋은 생각이 아니다.
- 이런 경우 인스턴스 변수에 인스턴스를 생성해서 사용하는 편이 좋다.

---------------------------------------------------------------------------------------------------------------------------------

> ## 해석 규칙.

### 다중 상속의 문제점.
- 인터페이스를 다중 상속할 때, 메서드의 시그니처가 같은 경우 어떤 인터페이스의 디폴트 메서드를 사용하는지 확인하는 방법이 필요하다.
- 자바 8은 이러한 문제에 대한 해결 규칙을 제공한다.


### 세 가지 해결 규칙.
1. 클래스가 항상 이긴다.
   - 클래스나 슈퍼클래스에서 정의한 메서드가 디폴트 메서드보다 우선권을 갖는다.
2. 1번 규칙 이외의 상황에서는 서브인터페이스가 이긴다.
   - 상속관계를 갖는 인터페이스에서 같은 시그치너를 갖는 메서드를 정의할 때는 서브인터페이스가 이긴다.
3. 여전히 우선순위가 결정되지 않았다면, 상속받는 클래스가 명시적으로 디폴트 메서드를 오버라이드하고 호출해야 한다.


### 디폴트 메서드가 제공하는 서브인터페이스가 이긴다.
- 복잡한 상속관계에서도 실제 디폴트 메서드가 정의된 인터페이스의 상속관계가 중요하다.


### 충돌 문제.
    public interface A {
        default Number getNumber() {
            return 10;
        }
    }

    public interface B {
        default Integer getNumber() {
            return 20;
        }
    }
- 거의 비슷한 시그니처에도 충돌 문제가 발생한다.


### C++ 다이아몬드 문제 diamond problem.
- C++ 다중 상속을 지원한다.
- 그래서, 복잡한 충돌 문제가 발생한다.


### 자바에서 충돌 문제.
- 자바는 위에서 언급한 세 가지 해결 규칙을 통해 충돌 문제를 해결한다.



















