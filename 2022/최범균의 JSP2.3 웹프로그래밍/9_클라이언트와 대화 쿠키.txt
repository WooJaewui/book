
 클라이언트와 대화 쿠키.



 # 쿠키 사용하기.

쿠키 cookie.
웹 브라우저가 보관하는 데이터이다.
웹 브라우저와 웹 서버가 공유하는 데이터이다.

쿠키 특성.
웹 브라우저는 웹 서버에 요청을 보낼 때 쿠키를 함께 전송한다.
웹 서버는 웹 브라우저가 전송한 쿠키를 사용해서 필요한 데이터를 읽을 수 있다.
웹 서버 웹 브라우저 모두 사용할 수 있다. ( JSP를 배우는 우리는 server에서 생성하는 방법을 배움 )

쿠키 동작 프로세스.
쿠키 생성 단계 : 웹 서버 측에서 생성하고, 응답 데이터의 헤더에 저장해서 웹 브라우저로 전송.
쿠키 저장 단계 : 웹 브라우저는 쿠키를 쿠키 저장소에 보관한다. 종류에 따라 메모리나 파일에 저장.
쿠키 전송 단계 : 웹 브라우저는 저장한 쿠키를 요청이 있을 때마다 웹 서버에 전송한다. 
쿠키 사용 단계 : 웹 서버는 브라우저가 전송한 쿠키를 사용해서 필요한 작업을 수행한다.

쿠키의 구성.
이름 : 쿠키를 구별하는 데 사용하는 이름.
값 : 쿠키의 이름과 관련된 값.
유효시간 : 쿠키의 유지 시간.
도메인 : 쿠키를 전송할 도메인.
경로 : 쿠키를 전송할 요청 경로.



 # 쿠키 메소드.

coockie 클래스에 메소드.
getName( ) : 쿠키 이름을 구한다.
getValue( ) : 쿠키 값을 구한다.
setValue( "value" ) : 쿠키 값을 지정한다.
setDomain( "pattern" ) : 이 쿠키가 전송될 서버의 도메인을 지정한다.
getDomain( ) : 쿠키의 도메인을 구한다.
setPath( "URL" ) : 쿠키를 전송할 경로를 지정한다.
getPath( ) : 쿠키의 전송 경로를 구한다.
setMaxAge( second ) : 쿠키의 유효시간을 초 단위로 지정한다.
getMaxAge( ) : 쿠키의 유효시간을 구한다.



 # JSP 쿠키 생성하기.

생성방법.
<% 
	Cookie cookie = new Cookie( "쿠키이름" , "쿠키값" ) 
	response.addCookie( cookie ) ;
%>

쿠키 값 읽기.
<% 
	request.getValue( ) ;
	URLDecoder.decode( cookie.getValue( ), "UTF-8" ) ; 
%>

과정설명.
쿠키 객체를 생성하고, response 객체에 쿠키를 추가한다. ( response flush되면 쿠키고 같이 전송 )

주의사항.
request.getCookies( )의 값이 없을 경우 null을 리턴함으로 NullPointerException을 예외처리해야 된다.



 # 쿠키 변경하기.

기존에 있는 쿠키를 변경하기.
Cookie cookie = new Cookie( "기존이름" , URLEncoder.encode( "새로운값" , "utf-8" ) ) ;
response.addCookie( cookie ) ;

추가설명.
Cookie 클래스는 쿠키를 삭제하는 기능을 제공하지 않는다.
setMaxAge( 초 )를 0으로 설정하여 삭제할 수 있다.


 
 # 쿠키의 도메인.

설명.
기본적으로 쿠키는 그 쿠키를 생성한 서버에만 전송된다.
도메인 설정을 통해 모든 서버에 도메인에 보낼 경우 사용한다. ( .domain.com ) ; 

사용.
cookie.setDomain( ".도메인.com" ) : mail.도메인.com, www.도메인.com 등 모두 쿠키 설정.
cookie.setDomain( "www.도메인.com" ) : www.도메인.com에만 쿠키 설정.

주의사항.
현재 서버의 도메인 또는 현재 도메인에 상위 도메인만 변경할 수 있다.
보안 문제 때문에 생성 도메인 이외에 다른 도메인으로 쿠키를 설정할 수 없다.
도메인을 따로 설정하지 않으면 쿠키를 생성한 도메인에서만 쿠키가 설정된다.
localhost로는 도메인을 확인할 수 없다. ( 실제 도메인이 있어야 테스트 가능 )



 # 쿠키의 경로.

설명.
도메인 범위를 지정한 이후에, 쿠키를 공유할 경로를 지정한다.
지정한 경로와 하위 경로에 대해서 쿠키를 설정한다.

사용.
cookie.setPath( "./경로" ) : 경로 + 하위 경로에 cookie 설정.
cookie.getPath( ) : 설정한 경로 리턴.



 # 쿠키의 유효시간.

설명.
웹 브라우저를 종료해도 유효시간이 지나지 않았으면 쿠키를 삭제하지 않는다.
유효시간을 지정하지 않으면 웹 브라우저를 종료할 때 쿠키를 함께 삭제한다.

사용.
cookie.setMaxAge( 초단위 시간 ) ;

추가설명.
아이디 기억하기 기능을 구현할 때 쿠키를 사용한다. ( 유효기간을 1달 정도로 잡기도 한다 )



 # 쿠키와 헤더.

설명.
response.addCookie( )를 통해 쿠키를 추가하면 Set-Cookie 헤더를 통해 쿠키를 전달한다.
한 개의 Set-Cookie 헤더는 한 개의 쿠기 값을 전달한다.

구성.
Set-Cookie : 쿠키이름=쿠키값 ; Domain=도메인값 ; Path=경로값; Expires=GMT형식의만료일시



 # 쿠키 처리를 위한 유틸리티 클래스.

설명.
만약에 쿠키를 생성하는 일이 많아진다면, 하나의 클래스로 만들어서 코드 중복을 줄일 수 있다.



 # 쿠키를 이용한 로그인 상태 유지.

과정 설명.
1. 로그인에 성공하면 특정 이름을 갖는 쿠키를 생성한다.
2. 해당 쿠키가 조재하면 로그인한 상태라고 판단한다.
3. 로그아웃하면 해당 쿠키를 삭제한다.

로그인 처리.
아이디와 비밀번호가 조건에 맞으면 쿠키를 생성해준다.

로그아웃 처리.
로그아웃 버튼을 클릭하면 쿠키의 유효시간 setMaxAge를 0으로 처리한다.




