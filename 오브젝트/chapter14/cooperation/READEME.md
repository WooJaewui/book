
# 일관성 있는 협력.

--------------------------------------------------------------------------------------------------------------

> ## 설계에 일관성 부여하기.

### 협력을 일관성 있게 만들기 위한 기본지침.
1. 변하는 개념을 변하지 않는 개념으로부터 분리하라.
2. 변하는 개념을 캡슐화하라.

### 변화는 개념을 변하지 않는 개념으로부터 분리하라.
- 변하는 개념을 별도의 서브타입으로 분리하고, 서브타입들을 클라이언트로부터 캡슐화해야 함.

### 변하는 개념을 캡슐화.
- 부모 클래스와 구현 클래스의 상속 계층을 구성하여 구체적인 내용을 캡슐화하자.
- 선택하는 추상화의 품질이 캡슐화의 품질을 결정한다.

### 데이터 은닉 data hiding.
- 모든 인스턴스 변수를 private으로 선언하고 메서드를 통해서만 사용하는 것.

### 캡슐화. (GOF)
- 캡슐화는 데이터 은닉 이상이다.
- 단순히 데이터를 감추는 것이 아니다.
- 변하는 어떤 것이든 감추는 것이다.
- 코드 수정으로 인한 파급효과를 제어할 수 있는 모든 기법이 캡슐화의 일종이다.

### 여러가지 캡슐화.
- 데이터 캡슐화.
  - private 인스턴스를 사용해서 데이터를 감춘다.
  - 클래스는 내부에 관리하는 데이터를 캡슐화한다.
- 메서드 캡슐화.
  - 인터페이스를 사용하면 클래스 외부에 영향을 미치지 않고 메서드를 수정할 수 있다. 
  - 클래스의 내부 행동을 캡슐화.
- 객체 캡슐화.
  - 포함을 의미한다.
  - 포함 관계일 때, 두 클래스 사이의 관계를 변경하더라도 외부에는 영향을 미치지 않는다.
- 서브타입 캡슐화.
  - 인터페이스를 통해 서브타입을 캡슐화한다.
  - 다형성을 기반으로 사용된다.

### 협력을 일관성 있게 만들기 위한 일반적인 캡슐화 방법.
- 서브타입 캡슐화와 객체 캡슐화를 조합하는 것.
- 인터페이스 상속 + 합성.

### 정리.
- 변하는 부분을 분리해서 타입 계층을 만든다.
  - 변하지 않는 부분으로부터 변하는 부분을 분리한다.
  - 변하는 부분들의 공통적인 행동을 추상 클래스나 인터페이스로 추상화한다.
  - 변하는 부분은 변하지 않는 부분의 서브타입으로 만든다.
- 변하지 않는 부분의 일부로 타입 계층을 합성한다.
  - 추상화(인터페이스, 추상클래스)를 통해 결합도를 낮게 합성한다.

--------------------------------------------------------------------------------------------------------------

> ## 일관성 있는 기본 정책 구현하기.

### 변경 캡슐화하기.
- 협력을 일관성 있게 만들기 위해서는 변경을 캡슐화해서 파급효과를 줄여야 한다.
- 변경을 캡슐화하는 가장 좋은 방법은 변하지 않는 부분으로부터 변하는 부분을 분리하는 것이다.
- 변하는 부분의 공통점을 추상화해야 한다.

### 개념적 무결성 Conceptual Integrity.
- 일관성과 동일한 뜻으로 간주해도 무방하다.
- 유사한 기능에 대해 유사한 협력 패턴을 적용하는 것으로 개념적 무결성을 유지할 수 있다.
- 저자는 시스템 설계에서 개념적 무결성이 가장 중요하다고 생각한다.
- 좋은 기능들이여도 서로 독립적이고 조화되지 못한 아이디어들을 담고 있는 시스템보다는 통합도니 일련의 시스템이 훨씬 좋다.

### 지속적으로 개선하라.
- 처음에는 일관성을 유지하는 것처럼 보이던 협력 패턴이 시간이 흐르면서 요구사항이 추가되면 일관성이 깨지는 상황이 발생된다.
- 협력은 고정된 것이 아니기 때문에 변경에 어려움을 겪는다면 과감하게 리팩토링해야 한다.

### 패턴을 찾아라.
- 일관성 있는 협력의 핵심은 변경을 분리하고 캡슐화하는 것이다.
- 훌륭한 설계자가 되는 첫걸음은 변경의 방향을 파악할 수 있는 날카로운 감각을 기르는 것이다.
- 변경에 탄력적으로 대응할 수 있는 다양한 캡슐화 방법과 설계 방버을 익히는 것 역시 중요하다.
- 현재 구조가 변경을 캡슐화하기에 적합하지 않다면 코드를 리팩터링하라.



















